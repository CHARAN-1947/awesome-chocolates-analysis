#combinig sales and geo table
SELECT * FROM sales as s
join
geo as g ON s.GeoID = g.GeoID;


#total sales amount for geographical area

SELECT geo, sum(Amount) as total_sales FROM sales as s
join
geo as g ON s.GeoID = g.GeoID
group by geo ;

#highest sales region
SELECT geo, Region, sum(amount) as total_sales FROM sales as s
join geo as g on s.GeoID = g.GeoID
group by geo, Region
order by sum(amount)  DESC
limit 1;

#which region has the lowest 
SELECT geo, Region, sum(amount) as total_sales FROM sales as s
join geo as g on s.GeoID = g.GeoID
group by geo, Region
order by sum(amount)  ASC
limit 1;

#how does sale performance vary over time across different regions
SELECT Geo, Region, sum(Amount) as total_sales, 
   year(SaleDate) as sales_year,
   month(SaleDate) as sales_month from sales as s
join
geo as g ON s.GeoID = g.GeoID
group by Geo, Region, year(SaleDate), month(SaleDate)
order by  Geo, Region, year(SaleDate), month(SaleDate);

#top selling products
select * from sales as s
join products as p on p.PID = s.PID ;

#what are the top selling products by total revenue
SELECT Product, sum(amount) as total_revenue,
product  FROM sales as s
join products as p on p.PID = s.PID 
group by Product
order by sum(amount)  DESC;

#which product categories contributes most to overall sales
SELECT Product, category, sum(amount) as total_revenue,
product  FROM sales as s
join products as p on p.PID = s.PID 
group by Product, category
order by sum(amount)  DESC;

#how does the sale performance of each product vary across different regions
select p.Product, g.Geo, g.Region , sum(Amount) as total_revenue from sales as s
join products as p on p.PID = s.PID join geo as g on g.GeoID = s.GeoID
group by p.Product, g.Geo, g.Region
order by sum(Amount) DESC;

#sales persons
#who are the top performing sale persons based on total sales revenue
select pe.Salesperson, sum(Amount) as total_revenue from sales as s
join people as pe on pe.SPID = s.SPID
group by pe.Salesperson
order by sum(Amount) desc limit 3;

#how does the sale performance of each salesperson compare across different region
select pe.Salesperson, g.Geo, g.Region, sum(Amount) as total_revenue
from sales as s
join people as pe on pe.SPID = s.SPID
join geo as g on g.GeoID = s.GeoID
group by pe.Salesperson, g.Region, g.Geo
order by sum(Amount) DESC;

#are there any trends or patterns in the sales performance of individual salespersons overtime
select pe.Salesperson, year(s.saledate) as sale_year, month(s.saledate) as sale_month, sum(Amount) as total_revenue
from sales as s
join people as pe on pe.SPID = s.SPID 
group by pe.Salesperson, year(s.saledate) , month(s.saledate)
order by sum(Amount) DESC;


#customer behaviour
#what is the average number of customers per sale
select Saledate, avg(customers) as average_sales from sales 
group by SaleDate
order by avg(customers) asc;

#how does the number of custommers per sale vary across different products or regions
select count(s.customers) , s.saledate, p.product, g.Region from sales as s
join products as p on p.PID = s.PID 
join geo as g on g.GeoID = s.GeoID
group by s.saledate, p.product, g.Region
order by count(s.customers) desc;

#are there any correlations between the number of customers and the total sales amount
select customers,sum(amount) as total_sales from sales
group by customers
order by customers desc;

#Product Profitability
#What is the total profit generated by each product
SELECT p.product,
    (SUM(s.amount) - (SUM(s.boxes) * p.cost_per_box)) AS total_profit
FROM sales AS s
JOIN products AS p ON p.pid = s.pid
GROUP BY p.product,p.cost_per_box
ORDER BY total_profit DESC; 

#How does the profitability of each product category compare?
SELECT category, SUM(total_profit) AS total_profits
FROM (
    SELECT p.category AS category,
        (SUM(s.amount) - (SUM(s.boxes) * p.cost_per_box)) AS total_profit
    FROM sales AS s
    JOIN products AS p ON p.pid = s.pid
    GROUP BY p.category, p.cost_per_box
) AS x
GROUP BY category;

#Are there any products with low sales volume but high profitability?
select product, sum(total_sales) as total_sales 
from (
    select p.product as product,
        sum(s.amount) as total_sales,
        round((sum(s.amount) - (sum(s.boxes) * p.cost_per_box)), 2) as total_profit,
        round((sum(s.amount) - (sum(s.boxes) * p.cost_per_box)) / sum(s.boxes), 2) as profitability_per_box
    from sales as s
    join products as p on p.pid = s.pid
    group by p.product, p.cost_per_box
) as x
where total_sales < (select avg(total_sales) from (
    select p.product as product, sum(s.amount) as total_sales
    from sales as s
    join products as p on p.pid = s.pid
    group by p.product, p.cost_per_box
) as y)
and profitability_per_box > (select avg(profitability_per_box) from (
    select p.product as product,
        round((sum(s.amount) - (sum(s.boxes) * p.cost_per_box)) / sum(s.boxes), 2) as profitability_per_box
    from sales as s
    join products as p on p.pid = s.pid
    group by p.product, p.cost_per_box
) as z)
group by  product
order by  product;

#Sales Trends over Time:
#How does sales revenue change over different time periods (e.g., monthly, quarterly, annually)?
select
    date_format(saledate, '%Y-%m') as period,
    sum(amount) as monthly_sales_revenue
FROM sales
GROUP BY date_format(saledate, '%Y-%m') 
;
select 
year(saledate) as period,
sum(amount) as yearly_sales_revenue
from sales
group by year(saledate) ;
# quaterly :
select
    concat(year(saledate), '-Q', quarter(saledate)) as period,
    sum(amount) as quarterly_sales_revenue
from sales
group by concat(year(saledate), '-Q', quarter(saledate));


#Are there any seasonal trends in sales performance?
select
    period,
    sum(quarterly_sales_revenue) as quarterly_sales_revenue
from (
    select
        concat(year(saledate), '-Q', dense_rank() over (partition by year(saledate) order by quarter(saledate))) as period,
        amount as quarterly_sales_revenue
    from sales
) as subquery
group by period
order by period;


#How do sales trends vary across different product categories or regions
select
    date_format(s.saledate, '%Y-%m') as period,
    p.category,
    g.region,
    sum(s.amount) as monthly_sales_revenue
from sales s
join products p on s.pid = p.pid
join geo as g on g.geoid = s.geoid
group by date_format(s.saledate, '%Y-%m'), p.category,g.region
order by period, p.category;
select
    period,
    category,
    region,
    monthly_sales_revenue,
    case
        when sales_rank = 1 then 'Highest'
        when rev_rank = 1 then 'Lowest'
    end as sales_type
from (
    select
        date_format(s.saledate, '%Y-%m') as period,
        p.category,
        g.region,
        sum(s.amount) as monthly_sales_revenue,
        rank() over (partition by g.region, p.category order by sum(s.amount) desc) as sales_rank,
        row_number() over (partition by g.region, p.category order by sum(s.amount) asc) as rev_rank
    from
        sales s
    join products p on s.pid = p.pid
    join geo g on g.geoid = s.geoid
    group by
        date_format(s.saledate, '%Y-%m'), p.category, g.region
) as sales_summary
where
    sales_rank = 1 or rev_rank = 1
order by
    period, category, region, sales_type;
    
#Salesperson Teams Analysis:
#What is the total sales revenue generated by each sales team?
select 
	p.product,
    pe.salesperson,
    sum(s.amount) as total_sales_revenue
from sales as s
join products as p on p.PID = s.PID
join people as pe on pe.SPID = s.SPID
group by p.product,pe.salesperson
order by total_sales_revenue desc;

#How does the performance of each sales team compare?
select 
	p.product,
    pe.salesperson,
    sum(s.amount) as total_sales_revenue
from sales as s
join products as p on p.PID = s.PID
join people as pe on pe.SPID = s.SPID
group by p.product,pe.salesperson
order by total_sales_revenue desc ;

#Are there any differences in sales performance between teams operating in differentÂ regions?
select g.region,
	p.product,
    pe.salesperson,
    sum(s.amount) as total_sales_revenue
from sales as s
join products as p on p.PID = s.PID
join geo as g on g.GeoID = g.GeoID
join people as pe on pe.SPID = s.SPID
group by g.region,p.product,pe.salesperson
order by total_sales_revenue desc;
